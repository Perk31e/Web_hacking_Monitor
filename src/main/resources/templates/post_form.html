<!-- templates/post_form.html - íŒŒì¼ ì—…ë¡œë“œ ì·¨ì•½ì ì´ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ” ë²„ì „ -->
<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸€ ì“°ê¸° - ë°˜ë ¤ë™ë¬¼ ì»¤ë®¤ë‹ˆí‹°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .upload-info {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
        }
        .vulnerability-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">ğŸ¾ PetCommunity</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/posts">ê²Œì‹œíŒ</a>
                <a class="nav-link" href="/mypage">ë§ˆì´í˜ì´ì§€</a>
                <a class="nav-link" href="/logout">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>ìƒˆ ê²Œì‹œê¸€ ì‘ì„±</h3>
                    </div>
                    <div class="card-body">
                        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

                        <!-- ì·¨ì•½ì : enctype="multipart/form-data"ë¡œ íŒŒì¼ ì—…ë¡œë“œ í—ˆìš© -->
                        <form method="post" action="/posts" enctype="multipart/form-data">
                            <div class="mb-3">
                                <label for="title" class="form-label">ì œëª© *</label>
                                <input type="text" class="form-control" id="title" name="title" required 
                                       placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                            </div>

                            <div class="mb-3">
                                <label for="content" class="form-label">ë‚´ìš© *</label>
                                <textarea class="form-control" id="content" name="content" rows="10" required
                                          placeholder="ë°˜ë ¤ë™ë¬¼ì— ëŒ€í•œ ì´ì•¼ê¸°ë¥¼ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                            </div>

                            <!-- ì·¨ì•½ì ì´ ëª…í™•í•˜ê²Œ ë“œëŸ¬ë‚˜ëŠ” íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
                            <div class="mb-3">
                                <label for="image" class="form-label">íŒŒì¼ ì—…ë¡œë“œ</label>
                                <!-- ì·¨ì•½ì  1: accept ì†ì„± ì—†ìŒ - ëª¨ë“  íŒŒì¼ íƒ€ì… í—ˆìš© -->
                                <input type="file" class="form-control" id="image" name="image">
                                
                                <div class="upload-info">
                                    <h6>ğŸ“ íŒŒì¼ ì—…ë¡œë“œ ì •ë³´</h6>
                                    <ul class="mb-0">
                                        <li><strong>í—ˆìš© í¬ê¸°:</strong> ìµœëŒ€ 100MB</li>
                                        <li><strong>íŒŒì¼ íƒ€ì…:</strong> ì œí•œ ì—†ìŒ (ëª¨ë“  í™•ì¥ì í—ˆìš©)</li>
                                        <li><strong>ì €ì¥ ìœ„ì¹˜:</strong> /static/uploads/ (ì›¹ ì ‘ê·¼ ê°€ëŠ¥)</li>
                                        <li><strong>íŒŒì¼ëª…:</strong> UUID + ì›ë³¸ í™•ì¥ì</li>
                                    </ul>
                                </div>

                                <!-- ê°œë°œìë¥¼ ìœ„í•œ ì·¨ì•½ì  íŒíŠ¸ (ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” ì œê±°í•´ì•¼ í•¨) -->
                                <div class="vulnerability-warning">
                                    <strong>âš ï¸ ë³´ì•ˆ í…ŒìŠ¤íŠ¸ìš© ì •ë³´:</strong><br>
                                    â€¢ íŒŒì¼ í™•ì¥ì ê²€ì¦ ì—†ìŒ<br>
                                    â€¢ MIME íƒ€ì… ê²€ì¦ ìš°íšŒ ê°€ëŠ¥<br>
                                    â€¢ ì›¹ ë””ë ‰í† ë¦¬ì— ì§ì ‘ ì €ì¥<br>
                                    â€¢ ì—…ë¡œë“œëœ íŒŒì¼ ì‹¤í–‰ ê¶Œí•œ ì œê±° ì•ˆí•¨
                                </div>

                                <div class="form-text">
                                    ë°˜ë ¤ë™ë¬¼ ì‚¬ì§„ì´ë‚˜ ê´€ë ¨ íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”. 
                                    <br><small class="text-muted">ì—…ë¡œë“œëœ íŒŒì¼ì€ /uploads/ ê²½ë¡œì—ì„œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤.</small>
                                </div>
                            </div>

                            <!-- íŒŒì¼ ì—…ë¡œë“œ ë¯¸ë¦¬ë³´ê¸° -->
                            <div id="imagePreview" style="display: none;" class="mb-3">
                                <label class="form-label">ë¯¸ë¦¬ë³´ê¸°</label>
                                <div>
                                    <img id="previewImg" style="max-width: 300px; max-height: 200px;" class="img-thumbnail">
                                    <p id="fileInfo" class="text-muted mt-2"></p>
                                </div>
                            </div>

                            <button type="submit" class="btn btn-primary btn-lg">ê²Œì‹œê¸€ ë“±ë¡</button>
                            <a href="/posts" class="btn btn-secondary btn-lg ms-2">ì·¨ì†Œ</a>
                        </form>
                    </div>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ ê°€ì´ë“œ -->
                <div class="card mt-4">
                    <div class="card-header">
                        <h5>ğŸ“‹ íŒŒì¼ ì—…ë¡œë“œ ê°€ì´ë“œ</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6>âœ… ê¶Œì¥ íŒŒì¼</h6>
                                <ul>
                                    <li>JPG, PNG, GIF (ì´ë¯¸ì§€)</li>
                                    <li>MP4, AVI (ë™ì˜ìƒ)</li>
                                    <li>PDF (ë¬¸ì„œ)</li>
                                    <li>TXT (í…ìŠ¤íŠ¸)</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <h6>âš ï¸ ì—…ë¡œë“œ í›„ ì ‘ê·¼</h6>
                                <ul>
                                    <li>ì—…ë¡œë“œ ê²½ë¡œ: <code>/uploads/íŒŒì¼ëª…</code></li>
                                    <li>ì˜ˆì‹œ: <code>/uploads/abc123.jpg</code></li>
                                    <li>ë¸Œë¼ìš°ì €ì—ì„œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥</li>
                                    <li>íŒŒì¼ ì‹¤í–‰ ê¶Œí•œ ìœ ì§€ë¨</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // íŒŒì¼ ì„ íƒ ì‹œ ë¯¸ë¦¬ë³´ê¸° ë° ì •ë³´ í‘œì‹œ
        document.getElementById('image').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('imagePreview');
            const previewImg = document.getElementById('previewImg');
            const fileInfo = document.getElementById('fileInfo');

            if (file) {
                // íŒŒì¼ ì •ë³´ í‘œì‹œ
                const fileSize = (file.size / 1024 / 1024).toFixed(2); // MB ë‹¨ìœ„
                fileInfo.innerHTML = `
                    <strong>íŒŒì¼ëª…:</strong> ${file.name}<br>
                    <strong>í¬ê¸°:</strong> ${fileSize} MB<br>
                    <strong>íƒ€ì…:</strong> ${file.type || 'ì•Œ ìˆ˜ ì—†ìŒ'}<br>
                    <strong>ë§ˆì§€ë§‰ ìˆ˜ì •:</strong> ${new Date(file.lastModified).toLocaleString()}
                `;

                // ì´ë¯¸ì§€ íŒŒì¼ì¸ ê²½ìš° ë¯¸ë¦¬ë³´ê¸° í‘œì‹œ
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        previewImg.src = e.target.result;
                        previewImg.style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                } else {
                    previewImg.style.display = 'none';
                }

                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        });
    </script>
</body>
</html>